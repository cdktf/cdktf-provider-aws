# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

name: provider-upgrade
on:
  schedule:
    - cron: 0 3 * * *
  workflow_dispatch: {}
jobs:
  upgrade:
    runs-on:
      - custom
      - linux
      - custom-linux-medium
    permissions:
      pull-requests: write
      issues: write
      contents: write
      statuses: write
    env:
      NODE_OPTIONS: --max-old-space-size=31744
    steps:
      - name: Checkout
        uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab
      - run: yarn install
      - id: check_version
        run: yarn check-if-new-provider-version
      - name: get provider current version
        id: current_version
        if: ${{ steps.check_version.outputs.new_version == 'available' }}
        run: echo "value=$(jq -r '.cdktf.provider.version' package.json)" >> $GITHUB_OUTPUT
      - if: ${{ steps.check_version.outputs.new_version == 'available' }}
        env:
          CHECKPOINT_DISABLE: "1"
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: yarn fetch
      - name: get provider updated version
        id: new_version
        if: ${{ steps.check_version.outputs.new_version == 'available' }}
        run: echo "value=$(jq -r '. | to_entries[] | .value' src/version.json)" >> $GITHUB_OUTPUT
      - if: ${{ steps.check_version.outputs.new_version == 'available' }}
        run: yarn compile
      - if: ${{ steps.check_version.outputs.new_version == 'available' }}
        run: yarn docgen
      - name: Create Pull Request
        if: ${{ steps.check_version.outputs.new_version == 'available' }}
        uses: peter-evans/create-pull-request@2b011faafdcbc9ceb11414d64d0573f37c774b04
        with:
          commit-message: "chore: upgrade provider from `${{ steps.current_version.outputs.value }}` to version `${{ steps.new_version.outputs.value }}`"
          branch: auto/provider-upgrade
          title: "chore: upgrade provider from `${{ steps.current_version.outputs.value }}` to version `${{ steps.new_version.outputs.value }}`"
          body: This PR upgrades provider to version ${{ steps.new_version.outputs.value }}
          labels: automerge
          token: ${{ secrets.GH_TOKEN }}
          delete-branch: true
          committer: team-tf-cdk <github-team-tf-cdk@hashicorp.com>
          author: Team Terraform CDK <github-team-tf-cdk@hashicorp.com>
